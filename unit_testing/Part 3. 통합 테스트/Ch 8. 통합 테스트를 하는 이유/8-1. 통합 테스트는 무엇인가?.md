통합 테스트는 아래 세가지의 단위 테스트 요구 사항 중 하나라도 만족하지 못하는 테스트이다.
1. 단일 동작 단위를 검증
2. 빠르게 수행
3. 다른 테스트와 별도로 처리

실제로 통합 테스트는 대부분 시스템이 프로세스 외부 의존성과 통합해 어떻게 작동하는지를 검증한다.
즉 단위 테스트가 도메인 모델을 다룬다면, 통합 테스트는 프로세스 외부 의존성과 도메인 모델을 연결하는 코드를 확인한다.

### 테스트 피라미드

단위 테스트와 통합 테스트 간의 균형을 유지하는 것이 중요하다.
통합 테스트가 프로세스 외부 의존성에 직접 작동하면 느려지며, 이러한 테스트는 유지비가 많이 든다.
유지비 증가의 이유는 아래와 같다.
- 프로세스 외부 의존성 운영이 필요함
- 관련된 협력자가 많아서 테스트가 비대해짐

그러나 통합 테스트는 코드를 더 많이 거치므로 회귀 방지가 단위 테스트보다 우수하다. 또한 제품 코드와의 결합도가 낮아서 리팩터링 내성도 우수하다.

단위 테스트와 통합 테스트의 비율은 프로젝트의 특성에 따라 다를 수 있지만, 일반적인 경험에 비춰본 규칙은 다음과 같다.
단위 테스트로 가능한 한 많이 비즈니스 시나리오의 예외 상황을 확인하고, 통합 테스트는 **주요 흐름**과 단위 테스트가 다루지 못하는 기타 **예외 상황** 을 다룬다.

- 주요 흐름: 시나리오의 성공적인 실행
- 예외 상황: 비즈니스 시나리오 수행 중 오류가 발생하는 경우

이를 정리하면, 대부분을 단위 테스트로 전환하여 유지비를 절감하고, 통합 테스트가 비즈니스 시나리오 당 하나 또는 두 개 있으면 시스템 전체의 정확도를 보장할 수 있다는 것이다.
따라서 테스트 피라미드는 프로젝트의 복잡도에 따라 모양이 다를 수는 있지만 대부분의 애플리케이션에서 아래와 같은 비율로 그려진다.

- 상위(작은 비율): 엔드 투 엔드 테스트
- 중간(중간 비율): 통합 테스트
- 하위(큰 비율): 단위 테스트

상위로 갈수록 회귀 방지, 리팩터링 내성에 뛰어나지만 빠른 피드백과 유지 보수성은 낮아진다.

### 통합 테스트와 빠른 실패

통합 테스트에서 프로세스 외부 의존성과의 상호 작용을 모두 확인하려면 가장 긴 주요 흐름을 선택하라.
이렇게 모든 상호 작용을 거치는 흐름이 없으면, 외부 시스템과의 통신을 모두 확인하는 데 필요한 만큼 통합 테스트를 추가로 작성하라.

물론 위와 같은 상황에서도 예외는 있다. 특정 예외 상황에서 잘못 실행되어 애플리케이션이 즉시 실패하면 해당 상황은 테스트할 필요가 없다. 이러한 경우에는 **빠른 실패 원칙**을 사용할 수 있다.

빠른 실패 원칙은 예기치 않은 오류가 발생하자마자 현재 연산을 중단하는 것을 의미하며, 이 원칙은 다음을 통해 애플리케이션의 안정성을 높인다.
- 피드백 루프 단축: 버그를 빨리 발견할수록 더 쉽게 해결할 수 있다.
- 지속성 상태 보호: 버그는 애플리케이션 상태를 손상시킨다. 손상된 상태가 데이터베이스로 침투하면, 고치기가 훨씬 어려워진다. 빨리 실패하면 손상의 확산을 막을 수 있다.

보통 예외를 던져 현재 연산을 중지한다. 예외는 그 의미가 빠른 실패 원칙에 완벽히 부합되기 때문이다.
예외는 프로그램 흐름을 중단하고 실행 스택에서 가장 높은 레벨로 올라간 후 로그를 남기고 작업을 종료하거나 재시작할 수 있다.