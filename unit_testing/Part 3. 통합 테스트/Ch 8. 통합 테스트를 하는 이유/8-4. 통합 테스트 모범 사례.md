통합 테스트를 최대한 활용하는 데 도움이 되는 몇 가지 일반적인 지침이 있다.
- **도메인 모델 경계 명시하기**
- **애플리케이션 내 계층 줄이기**
- **순환 의존성 제거하기**

### 도메인 모델 경계 명시하기

도메인 모델은 프로젝트가 해결하고자 하는 문제에 대한 도메인 지식의 모음이다. 따라서 코드베이스에서 가장 명시적이고 잘 알려진 위치에 두어야 한다. 이렇게 도메인 모델에 명시적 경계를 지정하면 코드의 해당 부분을 더 잘 보여주고 더 잘 설명할 수 있다.

또한 이렇게 하면 테스트에도 도움이 된다.
단위 테스트는 도메인 모델과 알고리즘을 대상으로 하고, 통합 테스트는 컨트롤러를 대상으로 한다.
도메인 클래스와 컨트롤러 사이의 명확한 경계로 단위 테스트와 통합 테스트의 차이점을 쉽게 구별할 수 있다.

이러한 경계는 별도의 네임스페이스 형태를 취할 수 있는데, 모든 도메인 로직이 뚜렷한 경계 안에 있고 코드베이스 여기저기에 흩어져 있지 않는 한, 그 세부 사항은 그다지 중요하지 않다.

### 계층 수 줄이기

대부분의 프로그래머는 간접 계층을 추가해 코드를 추상화하고 일반화하려고 한다. 일반적인 엔터프라이즈급 애플리케이션에서 여러 계층을 쉽게 찾아볼 수 있다.

하지만 극단적인 경우로, 애플리케이션에 추상 계층이 너무 많으면 코드베이스를 탐색하기 어렵고 아주 간단한 연산이라 해도 숨은 로직을 이해하기가 너무 어려워진다.

또한, 지나치게 많은 추상화는 단위 테스트와 통합 테스트에도 도움이 되지 않는다.
간접 계층이 많은 코드베이스는 컨트롤러와 도메인 모델 사이에 명확한 경계가 없는 편이기 때문이다.

이 뿐 아니라 위와 같은 설계의 테스트는 각 계층을 따로 검증하는 경향이 훨씬 강하다. 이러한 경향으로 인해 통합 테스트의 가치는 떨어지며, 각 테스트는 특정 계층의 코드만 실행하고 하위 계층은 목으로 처리한다. 결국 낮은 리팩터링 내성과 불충분한 회귀 방지라는 부정적인 결과를 가져온다.

가능한 한 간접 계층을 적게 사용하라. 대부분의 백엔드 시스템에서는 도메인 모델, 애플리케이션 서비스 계층(컨트롤러), 인프라 계층, 이 세 가지만 활용하면 된다.
인프라 게층은 보통 도메인 모델에 속하지 않는 알고리즘과 프로세스 외부 의존성에 접근할 수 있는 코드로 구성된다.

### 순환 의존성 제거하기

코드베이스의 유지 보수성을 대폭 개선하고 테스트를 더 쉽게 할 수 있는 또 다른 방법으로 순환 의존성을 제거하는 것이 있다.
- 순환 의존성: 둘 이상의 클래스가 제대로 작동하고자 직간접적으로 서로 의존하는 것을 말한다.

순환 의존성은 코드를 읽고 이해하려고 할 때 큰 부담으로 작용한다. 순환 의존성이 있으면 해결책을 찾기 위한 출발점이 명확하지 않기 때문이다. 결국 하나의 클래스를 이해하려면 주변 클래스 그래프 전체를 한 번에 읽고 이해해야 한다.

또한 이는 테스트를 방해한다. 클래스 그래프를 나눠서 동작 단위를 하나 분리하려면 인터페이스에 의존해 목으로 처리해야 하는 경우가 많으며, 이는 도메인 모델을 테스트할 때 해서는 안 된다.

인터페이스 사용은 순환 의존성의 문제만 가린다. 컴파일 타임에는 순환 참조를 제거할 수 있지만, 여전히 런타임에는 순환이 존재하기 때문이다.

순환 의존성을 처리하는 가장 좋은 방법은 순환 의존성을 제거하는 것이며, 모두 제거하는 것이 불가능하더라도 의존적인 클래스의 그래프를 가능한 한 작게 만드는 것이 손상을 최소화하는 방법이다.

### 테스트에서 다중 실행 구절 사용

테스트에서 두 개 이상의 준비나 실행 또는 검증 구절을 두는 것은 '코드 악취(Code Smell)'에 해당한다.
이는 테스트가 여러 가지 동작 단위를 확인해서 테스트의 유지 보수성을 저해한다는 신호다.

예를 들어, 아래와 같은 테스트 플로우가 있을 수 있다.
1. 준비: 사용자 등록에 필요한 데이터 준비
2. 실행: UserController.RegisterUser() 호출
3. 검증: 등록이 성공적으로 완료되었는지 확인하기 위해 데이터베이스 조회
4. 실행: UserController.DeleteUser() 호출
5. 검증: 사용자가 삭제되었는지 확인하기 위해 데이터베이스 조회

이러한 방식은 사용자의 상태가 자연스럽게 흐르기 때문에 설득력이 있고, 첫 번째 실행은 두 번째 실행의 준비 단계 역할을 할 수 있다. 하지만 문제는 이러한 테스트가 초점을 잃고 순식간에 너무 커질 수 있다는 것이다.

이러한 경우에는 각 테스트를 단일 동작 단위에 맞추기 위해 각 실행을 고유의 테스트로 추출해 나누는 것이 좋다. 이 작업은 장기적으로 유리하다.

물론 원하는 상태도 만들기 어렵거나 제약이 있는 프로세스 외부 의존성으로 작동하는 테스트의 경우에는 위 상황에서 예외가 될 수 있다.