통합 테스트는 시스템이 프로세스 외부 의존성과 어떻게 통합하는지를 검증한다.
이러한 검증을 구현하는 방식은 두 가지가 있다. 실제 프로세스 외부 의존성을 사용하거나 해당 의존성을 목으로 대체하는 것이다.

### 프로세스 외부 의존성의 두 가지 유형

1. 관리 의존성
	- 전체를 제어할 수 있는 프로세스 외부 의존성이다.
	- 애플리케이션을 통해서만 접근할 수 있으며, 해당 의존성과의 상호 작용은 외부 환경에서 볼 수 없다.
	- 대표적인 예로 데이터베이스가 있다.

2. 비관리 의존성
	- 전체를 제어할 수 없는 프로세스 외부 의존성이다.
	- 해당 의존성과의 상호 작용을 외부에서 볼 수 있다.
	- SMTP 와 메시지 버스 등이 있다.

관리 의존성과의 통신은 구현 세부 사항이고, 비관리 의존성과의 통신은 시스템의 식별할 수 있는 동작이다.
따라서 이러한 차이로 인해 통합 테스트에서 프로세스 외부 의존성의 처리가 달라진다.
**관리 의존성**은 실제 인스턴스를 사용하고, **비관리 의존성**은 목으로 대체하라.

위처럼 비관리 의존성에 대한 통신 패턴을 유지해야 하는 것은 하위 호환성을 지켜야 하기 때문이고, 이러한 작업에는 목이 제격이다.
목을 사용하면 모든 가능한 리팩터링을 고려해서 통신 패턴 영속성을 보장할 수 있다.

반대로, 관리 의존성과 통신하는 것은 애플리케이션뿐이므로 하위 호환성을 유지할 필요가 없다. 따라서 통합 테스트에서 관리 의존성의 실제 인스턴스를 사용하여 외부 클라이언트 관점에서 최종 상태를 확인한다.

### 관리 의존성이면서 비관리 의존성인 프로세스 외부 의존성 다루기

때로는 관리 의존성과 비관리 의존성 모두의 속성을 나타내는 프로세스 외부 의존성이 있을 수 있다.
이 때는 비관리 의존성의 특징을 띄는 부분에 목을 사용하고, 나머지 관리 의존성에 해당하는 부분에는 실제 인스턴스를 사용하여 상태를 확인할 수 있다.

### 통합 테스트에서 실제 데이터베이스를 사용할 수 없는 경우

떄로는 관리 범위를 벗어난다는 이유로, 통합 테스트에서 관리 의존성을 실제 인스턴스로 사용할 수 없는 경우도 있다.
이러한 상황에서는 어떻게 해야 할까? 관리 의존성임에도 불구하고 데이터베이스를 목으로 처리해야 할까?
그렇지 않다. 관리 의존성을 목으로 대체하면 통합 테스트의 리팩터링 내성이 저하되기 때문이다. 게다가 이렇게 하면 테스트의 회귀 방지성도 떨어진다.

만약 데이터베이스를 그대로 테스트할 수 없으면 통합 테스트를 아예 작성하지 말고 도메인 모델의 단위 테스트에만 집중하라.
항상 모든 테스트를 철저히 검토해야 한다. 가치가 충분하지 않은 테스트는 테스트 스위트에 있어서는 안 된다.