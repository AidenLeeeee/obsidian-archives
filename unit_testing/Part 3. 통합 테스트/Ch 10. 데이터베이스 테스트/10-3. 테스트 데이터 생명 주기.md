
공유 데이터베이스를 사용하면 통합 테스트를 서로 분리할 수 없는 문제가 생긴다. 이 문제를 해결하는 방법은 아래와 같다.
- 통합 테스트를 순차적으로 실행하라
- 테스트 실행 간에 남은 데이터를 제거하라

### 병렬 테스트 실행과 순차적 테스트 실행

통합 테스트를 병렬로 실행하려면 모든 테스트 데이터가 고유한지 확인해야 데이터베이스 제약 조건을 위반하지 않고 테스트가 다른 테스트 후에 입력 데이터를 잘못 수집하는 일이 없다. 또한 남은 데이터를 정리하는 것도 상당히 까다롭다.
따라서 성능 향상을 위해 테스트 병렬 실행에 시간을 쏟는 것보다 순차적으로 통합 테스트를 실행하는 것이 더 실용적이다.

### 테스트 실행 간 데이터 정리

테스트 실행 간에 남은 데이터를 정리하는 방법은 네 가지가 있다.
1. 각 테스트 전에 데이터베이스 백업 복원하기
	- 이 방법은 데이터 정리 문제를 해결할 수 있지만 다른 세 가지 방법보다 훨씬 느리다. 컨테이너를 사용한다고 하더라도 인스턴스 제거 후 새로운 컨테이너를 띄우는데 시간이 걸리기 때문에 전체 테스트 스위트 실행 시간이 늘어난다.
2. 테스트 종료 시점에 데이터 정리하기
	- 이 방법은 빠르지만 정리 단계를 건너뛰기 쉽다. 테스트 도중에 빌드 서버가 중단하거나 디버거에서 테스트를 종료하면 입력 데이터는 데이터베이스에 남아있고 이후 테스트 실행에 영향을 주게 된다.
3. 데이터베이스 트랜잭션에 각 테스트를 래핑하고 커밋하지 않기
	- 이 경우 테스트와 SUT 에서 변경한 모든 내용이 자동으로 롤백된다. 이 접근 방식은 정리 단계를 건너뛰는 문제를 해결하지만 또 다른 문제를 야기한다. 이는 작업 단위를 재사용할 때와 같은 문제인데, 추가 트랜잭션으로 인해 운영 환경과 다른 설정이 생성되는 것이다.
4. 테스트 시작 시점에 데이터 정리하기
	- 이 방법이 가장 좋다. 빠르게 작동하고 일관성이 없는 동작을 일으키지 않으며, 정리 단계를 실수로 건너뛰지 않는다.

### 인메모리 데이터베이스 피하기

통합 테스트를 서로 분리하는 또 다른 방법으로 SQLite 와 같은 인메모리 데이터베이스로 교체하는 방법도 있다. 인메모리 데이터베이스는 아래와 같은 장점을 가진다.
- 테스트 데이터를 제거할 필요가 없음
- 작업 속도 향상
- 테스트가 실행될 때마다 인스턴스화 가능

또한 인메모리 데이터베이스는 공유 의존성이 아니기 때문에 통합 테스트는 실제로 단위 테스트가 된다.

하지만 인메모리 데이터베이스는 일반 데이터베이스와 기능적으로 일관성이 없기 때문에 사용하지 않는 것이 좋다. 이는 또 다시 운영 환경과 테스트 환경이 일치하지 않는 문제이며, 이러한 차이로 인해 테스트에서 거짓 양성 또는 거짓 음성이 발생하기 쉽다.